#include <Windows.h>
#include <stdio.h>
#include <TlHelp32.h>
#include <tchar.h>


// Get threads that belong to a specific pid
// Using Thread32First/Thread32Next
// We take a snapshout of our system and iterate over the threads to find our's
// Make a snapshot of the system using CreateToolHelp32Snapshot

int main() {
	
	// Allocate struct for threads iterating
	THREADENTRY32* ptrThread = (THREADENTRY32*)calloc(1, sizeof(THREADENTRY32));
	ptrThread->dwSize = sizeof(THREADENTRY32);

	// Threads ID's list 
	// Change to whatever size you want
	int tid_list[5];
	int i = 0;
	ZeroMemory(tid_list, sizeof(int) * 5);

	// Here you need to get the PID you want and change the value
	int pid = 0;

	if (Thread32First(handleSnapshot, ptrThread) != TRUE) {
		_tprintf(TEXT("Cannot get first thread \r\n"));
		return 1;
	}
	do {
		// If the thread PID is equal to PID, add to list
		if (ptrThread->th32OwnerProcessID == pid) {
			tid_list[i] = ptrThread->th32ThreadID;
			i++;
		}
	} while (Thread32Next(handleSnapshot, ptrThread) == TRUE);
	
	return 0;
}
